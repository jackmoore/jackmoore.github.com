---
title: Maintainable JavaScript
layout: post
meta: 
date: 2012-08-07
tags: [jQuery, JavaScript]
published: false
---

I wanted to go through a couple of small things I do to make the JavaScript I write easier to read and maintain.

Here I'm going to go over a couple of patterns that help keep javascript easy to read and maintain.  Specifically, how to use closures to hide data and encapsulate logic.

This will be a brief overview of using closures to hide data and encapsulate logic.

## Scope in JavaScript

I'm not going to cover javascript's function scope

There's a good chance you are already creating a local scope for your code, rather than exposing all variables to the global scope.

## Creating A Local Scope

Javascript developers like to create a local scope for their code, rather than expose it to the global scope.  For example, take the following script block:

	<script>
		var msg = 'Hello World';
		function hello() {
			alert(msg);
		}
		hello();
	</script>

Here, the `msg` and `hello` identifiers are exposed to the global scope. Any other code executed in this environment will be able to change the values for `msg` and `hello`.  If I were to continue writing code this way, I would eventually accidentally reuse and identifier.  I would lose the data that was previously associated with the identifier, potentially causing bugs.  Since javascript has function scope, if we wrap the code in a function we can create a local scope for it:

	function foo(){
		var msg = 'Hello World';
		function hello() {
			alert(msg);
		}
		hello();
	};
	foo();

Here, `msg` and `hello` have their visibility limited to the `foo` function.  No code running outside of `foo` can access them.  But, if we don't plan on ever calling `foo` again then using a named function still adds an unnecessary identifier to the global namespace.  An immediately invoked function expression will allow us to execute code wrapped in an anonymous function:


	(function(){
		var msg = 'Hello World';
		function hello() {
			alert(msg);
		}
		hello();
	}());

## Using closures to hide data

I tend to create new scopes frequently in order to encapsulate related pieces of code, and to limit visibility of identifiers.  Smaller, limited scopes me read through and understand code. I feel overwhelmed when there are too many identifiers in a single namespace.

Here is a function that parses a querystring, and caches the results. The cache object is created outside of the function so that it's value is preserved between function calls.

	var cache = false;
	var GET = function (param) {
		var match, search, decode, query;
		if (cache === false) {
			cache = {};
			search = /([^&=]+)=?([^&]*)/g;
			decode = function (s) { return decodeURIComponent(s.replace(/\+/g, " ")); };
			query = window.location.search.substring(1);

			while ((match = search.exec(query)) !== null) {
				cache[decode(match[1])] = decode(match[2]);
			}
		}
		return cache[param];
	}

The `GET` function needs to be visible to other code, but the `cache` object does not. A closure can be used to hide the `cache` object from the rest of the project:

	var GET = (function () {
		var cache = false;

		return function(param){
			var match, search, decode, query;
			if (cache === false) {
				cache = {};
				search = /([^&=]+)=?([^&]*)/g;
				decode = function (s) { return decodeURIComponent(s.replace(/\+/g, " ")); };
				query = window.location.search.substring(1);

				while ((match = search.exec(query)) !== null) {
					cache[decode(match[1])] = decode(match[2]);
				}
			}
			return cache[param];
		};
	}());

Now, the scope of `cache` is limited to the `GET` function, and is hidden from the rest of the application.

## Creating a namespace

When I do need to expose data globally, I like to use a namespace.

	(function(){
		window.APP = window.APP || {};

		function somethingPrivate() {

		}

		APP.somethingPublic = function() {
			var data = somethingPrivate();
			return data;
		}
	}());
